@page "/customerdata"
@using BlazorBootstrap
@using EnterpriseMaster.DbServices.Models.Database;
@using EnterpriseMaster.DesktopApp.Data.Services.CustomerDataServices;
@inherits MainLayout

@inject CustomerDataService customerService

<Tabs EnableFadeEffect="true">
    <Tab>
        <TitleTemplate>
            <Icon Name="IconName.PersonArmsUp" /> Customer Profiles
        </TitleTemplate>
        <Content>
            <br />
            <Grid TItem="CustomerInformation"
                  @ref="gridCustomerInformation"
                  AllowFiltering="true"
                  AllowPaging="true"
                  AllowSorting="true"
                  AllowRowClick="true"
                  DataProvider="CustomerInformationDataProvider"
                  Class="table table-hover table-bordered table-striped"
                  FiltersRowCssClass="bg-dark text-white bg-opacity-25 border-bottom-0"
                  HeaderRowCssClass="bg-dark text-white border-bottom-0"
                  PageSize="5"
                  PageSizeSelectorVisible="true"
                  PageSizeSelectorItems="@(new int[] { 5,10,20 })"
                  PaginationItemsTextFormat="{0} - {1} of {2} pages"
                  ItemsPerPageText="Items per page"
                  Responsive="true">
                <GridColumn TItem="CustomerInformation" HeaderText="First Name" PropertyName="FirstName">
                    @context.FirstName
                </GridColumn>
                <GridColumn TItem="CustomerInformation" HeaderText="Last Name" PropertyName="LastName">
                    @context.LastName
                </GridColumn>
                <GridColumn TItem="CustomerInformation" HeaderText="Email" PropertyName="Email">
                    @context.Email
                </GridColumn>
                <GridColumn TItem="CustomerInformation" HeaderText="Phone" PropertyName="Phone">
                    @context.Phone
                </GridColumn>
                <GridColumn TItem="CustomerInformation" HeaderText="Company Name" PropertyName="Name">
                    @context.Company.Name
                </GridColumn>
            </Grid>
        </Content>
    </Tab>
    <Tab>
        <TitleTemplate>
            <Icon Name="IconName.PersonUp" /> Customer Segmentation
        </TitleTemplate>
        <Content>
            <p class="mt-2">
                <b>This is some placeholder content the Contact tab's associated content.</b> Clicking another tab will toggle the visibility of this one for the next.
            </p>
        </Content>
    </Tab>
    <Tab>
        <TitleTemplate>
            <Icon Name="IconName.Rss" /> Customer Feedback
        </TitleTemplate>
        <Content>
            <p class="mt-2">
                <b>This is some placeholder content the Contact tab's associated content.</b> Clicking another tab will toggle the visibility of this one for the next.
            </p>
        </Content>
    </Tab>
</Tabs>
@code {
    protected async override void OnInitialized()
    {
        customerInformation = await customerService.GetAllCustomerInformationAsync();

        await gridCustomerInformation.RefreshDataAsync();
    }

    #region CustomerInformation

    private List<CustomerInformation> customerInformation = new List<CustomerInformation>();
    private Grid<CustomerInformation> gridCustomerInformation;
    private async Task<GridDataProviderResult<CustomerInformation>> CustomerInformationDataProvider(GridDataProviderRequest<CustomerInformation> request)
    {
        if (customerInformation is null)
            customerInformation = await customerService.GetAllCustomerInformationAsync();

        return await Task.FromResult(request.ApplyTo(customerInformation));
    }

    #endregion
}
